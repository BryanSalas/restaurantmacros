<div class="container">
    <div class="jumbotron">
        <div class="rm-results">

            <!-- fixed header -->
            <div class="results-header" ng-class="{'fixed-header': fixed_header}" ng-style="fixed_width">
                <div ng-show="selected_restaurant.tab_selected == 'food'" class="flex-row align-center">
                    <div class="input-label">Search Food: </div>
                    <input class="form-control" ng-model="selected_restaurant.search" placeholder="Food name"/>
                </div>
                <div ng-show="selected_restaurant.tab_selected == 'meals'" class="flex-row align-center">
                    <div class="input-label">Add Meal: </div>
                    <form ng-submit="addMeal();">
                         <input id="add-meal-input" class="form-control" ng-model="selected_restaurant.new_meal" placeholder="Meal name"/>
                    </form>
                    <div ng-click="addMeal();" class="btn btn-sm btn-primary add-meal-button">Add new meal</div>
                </div>

                <ul class="nav nav-tabs">
                    <li role="presentation" ng-class="{'active': selected_restaurant.tab_selected == 'food'}">
                        <a href="" ng-click="selected_restaurant.tab_selected = 'food'">Food</a>
                    </li>
                    <li role="presentation" ng-class="{'active': selected_restaurant.tab_selected == 'meals'}">
                        <a href="" ng-click="selected_restaurant.tab_selected = 'meals'">Meals</a>
                    </li>
                </ul>

                <!-- food table fixed header -->
                <table ng-if="fixed_header && selected_restaurant.tab_selected == 'food'"
                       class="table table-striped fixed-header-table">
                    <thead class="header">
                        <tr>
                            <th ng-repeat="header in food_headers" ng-click="sortBy(header.key, true)" ng-class="{'first': $first}">
                                {{header.name}}
                                <span ng-class="{'glyphicon glyphicon-chevron-down': food_sort_by == header.key && !food_reverse_order,
                                'glyphicon glyphicon-chevron-up': food_sort_by == header.key && food_reverse_order}"/>
                            </th>
                            <th class="no-hover">
                                <div style="width: 40px;"></div>
                            </th>
                        </tr>
                    </thead>
                </table>

                <!-- meals table fixed header -->
                <table ng-if="fixed_header && selected_restaurant.tab_selected == 'meals'"
                       class="table table-striped fixed-header-table">
                    <thead class="header">
                        <tr>
                            <th ng-repeat="header in meal_headers" ng-click="sortBy(header.key, false)" ng-class="{'first': $first}">
                                {{header.name}}
                                <span ng-class="{'glyphicon glyphicon-chevron-down': meal_sort_by == header.key && !meal_reverse_order,
                                'glyphicon glyphicon-chevron-up': meal_sort_by == header.key && meal_reverse_order}"/>
                            </th>
                            <th>
                                <div style="width: 40px;"></div>
                            </th>
                        </tr>
                    </thead>
                </table>

            </div>

            <div ng-if="fixed_header" style="height: 142px;"></div>

            <!-- food section -->
            <table ng-if="selected_restaurant.tab_selected == 'food'" class="table table-striped">
                <thead class="header">
                    <tr ng-class="{'rm-hidden': fixed_header}" class="food-header">
                        <th ng-repeat="header in food_headers" ng-click="sortBy(header.key, true)"
                            ng-class="{'first': $first}">
                            {{header.name}}
                            <span ng-class="{'glyphicon glyphicon-chevron-down': food_sort_by == header.key && !food_reverse_order,
                                'glyphicon glyphicon-chevron-up': food_sort_by == header.key && food_reverse_order}"/>
                        </th>
                        <th class="no-hover"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="hit in selected_restaurant.hits | filter : selected_restaurant.search | orderBy : 'fields.' + food_sort_by : food_reverse_order"
                        class="food-row">
                        <td>{{hit.fields.item_name}}</td>
                        <td class="text-right">
                            <div>{{hit.fields.nf_calories}}</div>
                        </td>
                        <td class="text-right">
                            <div>{{hit.fields.nf_total_carbohydrate}}</div>
                        </td>
                        <td class="text-right">
                            <div>{{hit.fields.nf_total_fat}}</div>
                        </td>
                        <td class="text-right">
                            <div>{{hit.fields.nf_protein}}</div>
                        </td>
                        <td>
                            <div style="display: inline-block;" class="dropdown">
                              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1"
                                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                  <span class="glyphicon glyphicon-triangle-bottom"></span>
                              </button>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                  <li ng-click="createMealFromFood(hit.fields);">
                                      <a href="#">Create new meal</a>
                                  </li>
                                  <li ng-if="selected_restaurant.meals.length > 0" class="dropdown-header">Add to meal</li>
                                  <li ng-click="addToMeal(hit.fields, $index);" ng-repeat="meal in selected_restaurant.meals">
                                      <a href="#">{{meal.name}}</a>
                                  </li>
                              </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- meals section -->
            <table ng-if="selected_restaurant.tab_selected == 'meals'" class="table text-left" ng-style="fixed_width">
                <thead class="header meal-header">
                    <tr ng-class="{'rm-hidden': fixed_header}" class="meal-header">
                        <th class="no-hover"></th>
                        <th ng-repeat="header in meal_headers" ng-click="sortBy(header.key, false)"
                            ng-class="{'first': $first}">
                            {{header.name}}
                            <span ng-class="{'glyphicon glyphicon-chevron-down': meal_sort_by == header.key && !meal_reverse_order,
                                'glyphicon glyphicon-chevron-up': meal_sort_by == header.key && meal_reverse_order}"/>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="meal in selected_restaurant.meals | orderBy : meal_sort_by : meal_reverse_order">
                        <td>
                            <span ng-click="meal.open = !meal.open" class="glyphicon glyphicon-triangle-right"
                                  ng-class="{'open': meal.open}"></span>
                            <span style="margin-bottom: 10px;" ng-click="removeFood(meal, $index);" class="glyphicon glyphicon-remove" ng-if="meal.open"
                                  ng-repeat="food in meal.food track by $index"></span>
                        </td>
                        <td>
                            <span ng-class="{'meal-data': meal.open}">{{meal.name}}</span>
                            <div class="food-in-meal" ng-if="meal.open" ng-repeat="food in meal.food track by $index">{{food.item_name}}</div>
                            <div class="food-in-meal font-bold" ng-if="meal.open">Total</div>
                        </td>
                        <td>
                            <span ng-class="{'rm-hidden': meal.open, 'meal-data': meal.open}">{{meal.calories}}</span>
                            <div class="food-in-meal" ng-if="meal.open" ng-repeat="food in meal.food track by $index">{{food.nf_calories}}</div>
                            <div class="food-in-meal font-bold" ng-if="meal.open">{{meal.calories}}</div>
                        </td>
                        <td>
                            <span ng-class="{'rm-hidden': meal.open, 'meal-data': meal.open}">{{meal.carbs}}</span>
                            <div class="food-in-meal" ng-if="meal.open" ng-repeat="food in meal.food track by $index">{{food.nf_total_carbohydrate}}</div>
                            <div class="food-in-meal font-bold" ng-if="meal.open">{{meal.carbs}}</div>
                        </td>
                        <td>
                            <span ng-class="{'rm-hidden': meal.open, 'meal-data': meal.open}">{{meal.fat}}</span>
                            <div class="food-in-meal" ng-if="meal.open" ng-repeat="food in meal.food track by $index">{{food.nf_total_fat}}</div>
                            <div class="food-in-meal font-bold" ng-if="meal.open">{{meal.fat}}</div>
                        </td>
                        <td>
                            <span ng-class="{'rm-hidden': meal.open, 'meal-data': meal.open}">{{meal.protein}}</span>
                            <div class="food-in-meal" ng-if="meal.open" ng-repeat="food in meal.food track by $index">{{food.nf_protein}}</div>
                            <div class="food-in-meal font-bold" ng-if="meal.open">{{meal.protein}}</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>